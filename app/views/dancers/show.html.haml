.container
  .col-md-3
    %br
    =image_tag(@dancer.avatar.url, size: "190", class: "img-rounded center-block")
    %p
      %hr
      %b Year:
      Sophomore
      %br
      %b Dancing for:
      =@dancer.dancing_for
      %br
      %b Bio:
      =@dancer.bio
    %hr
    .small.text-muted Share this dancer
    %a.no-underline.icon-facebook{:href => "http://www.facebook.com/", :onclick => "popUp=window.open('http://www.facebook.com/sharer.php?u=http://example.com','popupwindow','scrollbars=yes,width=800,height=400');popUp.focus();return false", :rel => "nofollow"}
      %i.fa.fa-2x.fa-facebook-square
    %a.no-underline.icon-twitter{:href => "http://twitter.com/", :onclick => "popUp=window.open('http://twitter.com/intent/tweet?text=\\'[Page Title]\\' via @[handle] - [url]','popupwindow','scrollbars=yes,width=800,height=400');popUp.focus();return false", :rel => "nofollow"}
      %i.fa.fa-2x.fa-twitter-square
    %a.no-underline.icon-gplus{:href => "http://www.plus.google.com/", :onclick => "popUp=window.open('https://plus.google.com/share?url=http://example.com','popupwindow','scrollbars=yes,width=800,height=400');popUp.focus(); return false", :rel => "nofollow"}
      %i.fa.fa-2x.fa-google-plus-square
    %a.no-underline.icon-email{:href => "mailto:?subject=[Page Title] via [Site Name]& body=I've just read '[Page Title]' at [url]", :rel => "nofollow"}
      %i.fa.fa-2x.fa-share-square
  .col-md-8
    %h2
      = @dancer.first_name
      = @dancer.last_name
      %small= link_to(@dancer.team.name, @dancer.team)
      %br
      - if can? :manage, :all
        = link_to('Edit', edit_dancer_path(@dancer), class: "btn btn-default btn-sm")
        = link_to('Delete this dancer', @dancer, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger btn-sm")
    .panel.panel-default.panel-body
      %h4
        = @dancer.first_name
        has raised 
        %span.text-success= number_to_currency(dancer_amount_raised(@dancer))
      .text-muted
        Send a donation to 
        = @dancer.first_name
        to help
        - if @dancer.gender == "male"
          his
        - else
          her
        campaign!
      %hr
      .form-inline
        .form-group
          .input-group
            .input-group-addon $
            = text_field_tag :donation_amount, params[:donation_amount], class: "form-control", placeholder: "Amount", id: "total-amount-val"
            .input-group-addon .00
          %button{class: "btn btn-md btn-primary", id: "stripeButton"}
            Donate to 
            = @dancer.first_name
          %span.action
            :javascript
              var handler = StripeCheckout.configure({
                key: "#{Rails.configuration.stripe[:publishable_key]}",
                locale: 'auto',
                token: function(token) {
                  var tokenInput = $("<input type=hidden name=stripeToken />").val(token.id);
                  var emailInput = $("<input type=hidden name=stripeEmail />").val(token.email);
                  $("form").append(tokenInput).append(emailInput).submit();
                }
              });

              $('#stripeButton').on('click', function(e) {
                var amount = $("#total-amount-val").val();
                if(amount > 0) {
                  handler.open({
                    name: "Donation to #{@dancer.first_name}",
                    amount: amount*100,
                    billingAddress: true
                  });
                }
                e.preventDefault();
              });

              // Close Checkout on page navigation
              $(window).on('popstate', function() {
                handler.close();
              });
      %br
      .progress
        - if @amount_raised_goal > 100
          .progress-bar.progress-bar-success.progress-bar-striped{:role => "progressbar", :style => "width: #{@amount_raised_goal}%"}
            = @dancer.first_name
            has exceeded
            - if @dancer.gender == "male"
              his
            - else
              her
            goal by
            =number_to_percentage(@amount_raised_goal, precision: 0)
        - if @amount_raised_goal < 100
          .progress-bar.progress-bar-primary.progress-bar-striped{:role => "progressbar", :style => "width: #{@amount_raised_goal}%"}
            = @dancer.first_name
            has reached
            =number_to_percentage(@amount_raised_goal, precision: 0)
            of 
            - if @dancer.gender == "male"
              his
            - else
              her
            goal!
    - @donations.each do |donation|
      - donor = Dancer.where(email: donation.email).present?
      .panel.panel-default.panel-body
        .row
          - if donor.present?
            .col-md-1
              = image_tag(donor.avatar, class: "img-rounded", size: "40")
          .col-md-8
            - if donor.present?
              = donor.first_name
              donated
              %span.text-success
                =number_to_currency(donation.amount)
              to
              =@dancer.first_name
            - else
              = @dancer.first_name
              received a
              %span.text-success
                =number_to_currency(donation.amount)
              donation.
          .col-md-3
            %span.text-muted.small
              = time_ago_in_words(donation.created_at)
              ago
  .col-md-1
    - if can? :manage, :all
      %br
      %h3
        %i.fa.fa-key
        Access
      = link_to "Staff", {controller: "/dancers", action: :set_staff}, class: "btn btn-default btn-md btn-block"
      = link_to "Admin", {controller: "/dancers", action: :set_admin}, class: "btn btn-default btn-md btn-block"

