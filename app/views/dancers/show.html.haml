.container
  .col-md-3
    %br
    =image_tag(@dancer.avatar.url(:medium), size: "190", class: "img-responsive img-rounded center-block")
    - if @dancer.stafftitle.present?
      %p
        %h5.text-center= @dancer.stafftitle
    %p
      %hr
      %b Year:
      Sophomore
      %br
      %b Dancing for:
      =@dancer.dancing_for
      %br
      %b Bio:
      =@dancer.bio
      %br
    %hr
    .small.text-muted Share this dancer
    %a.no-underline.icon-facebook{:href => "http://www.facebook.com/", :onclick => "popUp=window.open('http://www.facebook.com/sharer.php?u=http://example.com','popupwindow','scrollbars=yes,width=800,height=400');popUp.focus();return false", :rel => "nofollow"}
      %i.fa.fa-2x.fa-facebook-square
    %a.no-underline.icon-twitter{:href => "http://twitter.com/", :onclick => "popUp=window.open('http://twitter.com/intent/tweet?text=\\'[Page Title]\\' via @[handle] - [url]','popupwindow','scrollbars=yes,width=800,height=400');popUp.focus();return false", :rel => "nofollow"}
      %i.fa.fa-2x.fa-twitter-square
    %a.no-underline.icon-gplus{:href => "http://www.plus.google.com/", :onclick => "popUp=window.open('https://plus.google.com/share?url=http://example.com','popupwindow','scrollbars=yes,width=800,height=400');popUp.focus(); return false", :rel => "nofollow"}
      %i.fa.fa-2x.fa-google-plus-square
    %a.no-underline.icon-email{:href => "mailto:?subject=[Page Title] via [Site Name]& body=I've just read '[Page Title]' at [url]", :rel => "nofollow"}
      %i.fa.fa-2x.fa-share-square
    - if can? :manage, :all
      %br
      %hr
      %h4 Access
      = link_to "Staff", {controller: "/dancers", action: :set_staff}, class: "btn btn-default btn-md btn-block"
      = link_to "Admin", {controller: "/dancers", action: :set_admin}, class: "btn btn-default btn-md btn-block"

  .col-md-8
    %h2
      = name(@dancer)
      %small= link_to(@dancer.team.name, @dancer.team)
      %br
      - if can? :manage, @dancer
        = link_to('Edit your profile', edit_dancer_path(@dancer), class: "btn btn-default btn-sm")
        = link_to('Delete your profile', @dancer, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger btn-sm")
    .panel.panel-default.panel-body
      %h4
        = @dancer.first_name
        has raised 
        %span.text-success= number_to_currency(dancer_amount_raised(@dancer))
      .progress
        .progress-bar.progress-bar-success.progress-bar-striped{:role => "progressbar", :style => "width: #{number_to_percentage(@amount_raised_goal, precision: 0)}", "aria-valuemax" => "100", "aria-valuemin" => "0", "aria-valuenow" => "#{@amount_raised_goal}"}
          =number_to_percentage(@amount_raised_goal, precision: 0)
      %hr
      %p.text-muted
        Send a donation to 
        = @dancer.first_name
        to help
        - if @dancer.gender == "male"
          his
        - else
          her
        campaign!
      = form_for @charge do
        .form-inline
          .form-group
            .input-group
              .input-group-addon $
              = text_field_tag :donation_amount, params[:donation_amount], class: "form-control", placeholder: "Amount", id: "total-amount-val"
              .input-group-addon .00
            %button{class: "btn btn-md btn-primary", id: "stripeButton"}
              Donate to 
              = @dancer.first_name
            %span.action
              :javascript
                var handler = StripeCheckout.configure({
                  key: "#{Rails.configuration.stripe[:publishable_key]}",
                  locale: 'auto',
                  token: function(token) {
                    var tokenInput = $("<input type=hidden name=stripeToken />").val(token.id);
                    var emailInput = $("<input type=hidden name=stripeEmail />").val(token.email);
                    var is_donation = $("<input type=hidden name=is_donation value=true />")
                    var charge_type = $("<input type=hidden name=charge_type value=Dancer />")
                    var dancer_id = $("<input type=hidden name=dancer_id value=#{@dancer.id} />")
                    $("form").append(tokenInput).append(emailInput).append(is_donation).append(charge_type).append(dancer_id).submit();
                  }
                });

                $('#stripeButton').on('click', function(e) {
                  var amount = $("#total-amount-val").val();
                  if(amount > 0) {
                    handler.open({
                      name: "Donation to #{@dancer.first_name}",
                      amount: amount*100,
                      billingAddress: true
                    });
                  }
                  e.preventDefault();
                });

                // Close Checkout on page navigation
                $(window).on('popstate', function() {
                  handler.close();
                });
    - @donations.each do |donation|
      - donor = Dancer.find_by(email: donation.email)
      .panel.panel-default.panel-body
        .row
          - if donor.present?
            .col-md-1
              = image_tag(donor.avatar.url, class: "img-rounded", size: "40")
          .col-md-8
            - if donor.present?
              = link_to name(donor), donor
              donated
              %span.text-success
                =number_to_currency(donation.amount)
              to
              =@dancer.first_name
            - else
              = @dancer.first_name
              received a
              %span.text-success
                =number_to_currency(donation.amount)
              donation
            - if current_dancer.present?
              - if @dancer.id == current_dancer.id
                %span.text-muted
                  %br
                  Given by 
                  = donation.email
          .col-md-3
            %span.text-muted.small.pull-right.text-right
              = time_ago_in_words(donation.created_at)
              ago
  .col-md-1

